$(document).ready(function(){function i(i){var t=i.join();$.ajax({url:"/rain_barrel/email_alert",type:"GET",data:{alerts:t},success:function(){console.log("e-mailed the alert!")}})}$(".help").click(function(){"none"==$(this).find(".tooltip").css("display")?$(this).find(".tooltip").css("display","block"):$(this).find(".tooltip").css("display","none")}),$(".login-link").click(function(i){i.preventDefault(),"none"==$(".login-popup").css("display")?$(".login-popup").css("display","block"):$(".login-popup").css("display","none")}),$(".label").click(function(){$(this).siblings().css("opacity","1"),$(this).css("opacity","0")});var t=0,l=0,a=0,e=function(){console.log("in ping"),$.ajax({url:"/rain_barrel/stats",type:"GET",success:function(s){var o=s.current_volume,r=s.capacity_in_gallons,n=parseInt($("#barrel").css("height")),h=o/r,d=o/r*100,p=100-d,g=n*h;$("#water_level").animate({top:p+"%",height:g+"px"},2e3,function(){}),$(".circle-wl").animate({"margin-top":"-"+g+"px"},2e3,function(){}),$("#pH .data-elt .data-bit").html(s.ph),$("#TDS .data-elt .data-bit").html(s.total_dissolved_solids);var c={pH:"",TDS:"",filter:""};s.ph<6?(c.pH="",c.pH="pH is too low ("+s.ph+")",t++,$("#pH .data-elt .data-bit").removeClass("green_highlight yellow_highlight"),$("#pH .data-elt .data-bit").addClass("red_highlight"),s.total_dissolved_solids>400||($("#pH .fix").css("display","block"),$("#pH .fix").addClass("highlight")),$(".logo span").css("color","red")):s.ph>8?(c.pH="",c.pH="pH is too high ("+s.ph+")",t++,$("#pH .data-elt .data-bit").removeClass("green_highlight yellow_highlight"),$("#pH .data-elt .data-bit").addClass("red_highlight"),s.total_dissolved_solids>400||($("#pH .fix").css("display","block"),$("#pH .fix").addClass("highlight")),$(".logo span").css("color","red")):s.ph>=6&&s.ph<=6.5||s.ph<=8&&s.ph>=7.5?($("#pH .data-elt .data-bit").removeClass("green_highlight red_highlight"),$("#pH .data-elt .data-bit").addClass("yellow_highlight"),$(".logo span").css("color","yellow"),$("#pH .fix").removeClass("highlight")):s.ph>6.5&&s.ph<7.5&&($("#pH .data-elt .data-bit").removeClass("yellow_highlight red_highlight"),$("#pH .data-elt .data-bit").addClass("green_highlight"),$(".logo span").css("color","green"),$("#pH .fix").removeClass("highlight")),s.total_dissolved_solids<=50?($("#TDS .data-elt .data-bit").removeClass("yellow_highlight red_highlight"),$("#TDS .data-elt .data-bit").addClass("green_highlight"),$(".logo span").css("color","green"),$("#TDS .fix").removeClass("highlight")):s.total_dissolved_solids>50&&s.total_dissolved_solids<=400?($("#TDS .data-elt .data-bit").removeClass("green_highlight red_highlight"),$("#TDS .data-elt .data-bit").addClass("yellow_highlight"),$(".logo span").css("color","yellow"),$("#TDS .fix").removeClass("highlight")):s.total_dissolved_solids>400&&(c.TDS="",c.TDS="TDS is too high ("+s.total_dissolved_solids+")",l++,$("#TDS .data-elt .data-bit").removeClass("green_highlight yellow_highlight"),$("#TDS .data-elt .data-bit").addClass("red_highlight"),$("#TDS .fix").css("display","block"),$("#TDS .fix").addClass("highlight"),$(".logo span").css("color","red")),console.log(s),console.log(s.filter_life_remaining),s.filter_life_remaining<8&&(c.filter="",c.filter="Filter life remaining: "+s.filter_life_remaining+" days",a++,$(".logo span").css("color","red")),email_alerts=[];for(marker in c)"pH"==marker&&""!==c[marker]&&($("#alert").css("display","block"),1==t?($(".warning-text").append("<p id='ph_warning'>"+c[marker]+"</p>"),email_alerts.push(c[marker])):$("#ph_warning").html(c[marker])),"TDS"==marker&&""!==c[marker]&&($("#alert").css("display","block"),1==l?($(".warning-text").append("<p id='tds_warning'>"+c[marker]+"</p>"),email_alerts.push(c[marker])):$("#tds_warning").html(c[marker])),"filter"==marker&&""!==c[marker]&&($("#alert").css("display","block"),1==a?($(".warning-text").append("<p id='filter_warning'>"+c[marker]+"</p>"),0==l&&0==t&&$(".warning-link").attr("href","/rain_barrel/filter_life"),email_alerts.push(c[marker])):$("#filter_warning").html(c[marker]));0!=email_alerts.length&&i(email_alerts),s.ph>6&&s.ph<8&&s.total_dissolved_solids<400&&s.filter_life_remaining>=8&&$("#alert").css("display","none"),console.log(s),setTimeout(function(){e()},1e3)}})};e(),$(".fix_link").click(function(){"none"==$(this).parent().parent().find(".fix").css("display")?($(this).parent().parent().find(".fix").slideDown("slow"),$(this).parent().find(".triangle-down").css("left","106%"),$(this).html("Close instruction text"),$(this).parent().find(".triangle-down").stop().animate({rotation:180},{duration:500,step:function(i){$(this).css({transform:"rotate("+i+"deg)"})}})):($(this).parent().parent().find(".fix").slideUp("slow"),$(this).parent().find(".triangle-down").css("left","103%"),$(this).html("Click for intructions when pH levels are unsafe "),$(this).parent().find(".triangle-down").stop().animate({rotation:360},{duration:500,step:function(i){$(this).css({transform:"rotate("+i+"deg)"})}}))})});